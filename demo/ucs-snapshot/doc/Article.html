<html>

    <head>
        <title> A UCS Backup Strategy </title>
    </head>

<body>

A single UCS domain may consist of up to 160 servers as well as unified network and storage infrastrastructure.   
This infrastructure represents a significant investment and is the foundation for delivering applications
and services at scale.  Due to this scale and the significance of its role in the data center,  
UCS should be deployed in conjunction with a backup strategy.  The backup strategy should capture the UCS
system state and configuration at regular intervals.  For this purpose, UCS provides several different
types of backups that administrators can initiate or schedule at regular intervals.
There various types of backups are described below:

<ul>

<li> Full State - a snap-shot of the entire system.  It produces a binary file 
can be used to restore or rebuild the system's configuration on the original fabric interconnect
or to recreate the configuration on a different fabric interconnect.

<li> All Configuration - an XML file that includes the system and logical configuration settings.  
This file that can be imported to the original (or other) fabric interconnect.

<li> Logical Configuration - an XML file that includes only logical configuration settings.

<li> System Configuration - an XML file that includes only related configuration.

</ul>

Best practices dictate that Full State and All Configuration backups be performed at regular 
intervals.  This approach will provide access to the necessary artifacts to recover from almost any 
failure scenario.  There are several short-comings with this approach.  Although we have the 
necessary artifacts for recovery, they may not be in the optimal format for consumption. 
For example, the Full State backup contains complete system information, but,
that information is in binary format.  This means an operator cannot browse or edit the contained data.
The Full State backup can only be applied in an "all or nothing" approach to recover a UCS system.
The other backup types (All Configuration, Logical Configuration and System Configuration) 
capture configuration data in xml format that can be imported into UCS Manager in a recovery scenario.
Although these files are limited to configuration data, the following information is not accessible: 

<ul>
<li> State information like faults, statistics and configuration errors.  
<li> Operational information like the identities (macs, wwn's, ip addresses) applied to the hardware.
This would include the policies referenced from a service profile and the VLAN ids used by a service
profile's vNICS.
<li> Hardware and firmware inventory.  
</ul>

<p>

This information would be useful for disaster recovery scenarios.  For example, during 
system recovery, operators should be able to quickly determine the 
hardware and firmware versions of all components in their domain.  They could use this 
information to identify differences between the original and recovered system since such
differences may be the source of inconsistent.
Similarly, operators would like to be able to view the backed up system's policies 
in conjunction with its state information.  This will allow the operator to check if
a fault on the recovered system existed on the backed up system.  Ideally, this information
would be accessible in a well organized and graphical format since backups are often
several megabytes in size and contain configuration data spanning the storage, networking 
and compute domains.  

</p>
The above short-comings can be addressed by leveraging the UCS XML API to extract the pertinent
information.  This information can then be organized in a manner that is optimized for disaster 
recovery scenarios.  This can be accomplished through the use of two simple XML scripts, described below:

<ol>
<li> ucs-backup-mit - queries the entire MIT and stores it as a backup xml file;  The file can subseqently be 
processed off-line.
<li> ucs-backup-report - produces a report from the backup xml file produced by ucs-backup-mit.  
</ol>

These two scripts are available for download as part of a perl UcsSimple-CommMgr package. 
<a> href="https://github.com/greygoose/UcsSimple-CommMgr" </a>

<pre>
<code>
    ucs-backup-mit --cfg=./cfg/backup.cfg 

    ucs-backup-report backup/ucs-backup-2013-07-30-22_36_43.xml
</code>
</pre>

I installed these scripts and ran them on a scaled out UCS system. The backup of the entire MIT 
was 108M in size and contained 260,000 xml elements (which are UCS managed objects). 
The ucs-backup-report scripts mines the backup and generates a web pages report of the UCS system.
It presents data on the following system level information:

<ul>
<li> Hardware inventory for each UCS component;
<li> The installed firmware version for each UCS component;
<li> A fault report with the complete list of UCS faults including their severity;
<li> Navigation links to view the xml content to configure many UCS policies;
<li> LAN and SAN configuration information;
<li> UCS identity report - mac, wwn, wwpn, uuid, iqn;
</ul>

For each service profile, there is the following information:

<ul>
<li> All policies referenced from there service profile;
<li> Hardware and firmware information if the service profile is associated with hardware;
<li> LAN and SAN configuration;
<li> Identities used by the service profile;
</ul>

Whether you are recovering from multiple failed components or the inadvertent deletion of a policy
the above report will prove useful.  You can modify or augment this report to harvest the
information that is most valuable to your UCS deployment.  Also, since the report is produced off-line,
you cannot affect the production system and you always have the complete MIT in an xml file at your
disposal.

</body>
</html>



